<script>
  let obs;
  let isConnected = false;

  async function connectOBS() {
    try {
      obs = new WebSocket("ws://localhost:4455");

      obs.onopen = () => {
        console.log("ðŸ”Œ Conectado ao OBS WebSocket");
        // Enviar autenticaÃ§Ã£o
        obs.send(JSON.stringify({
          op: 1,
          d: {
            rpcVersion: 1,
            authentication: "NHDRI3aB60pJVPEw"
          }
        }));
      };

      obs.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        if (msg.op === 2) {
          console.log("âœ… Autenticado no OBS");
          isConnected = true;
        } else if (msg.op === 5) {
          console.log("ðŸ“© Evento recebido:", msg);
        }
      };

      obs.onerror = (err) => {
        console.error("Erro OBS WebSocket:", err);
      };

      obs.onclose = () => {
        console.warn("ðŸ”Œ OBS desconectado");
        isConnected = false;
      };
    } catch (err) {
      console.error("Erro ao conectar:", err);
    }
  }

  async function changeScene(sceneName) {
    if (!isConnected) {
      alert("OBS nÃ£o estÃ¡ conectado.");
      return;
    }

    const msg = {
      op: 6,
      d: {
        requestType: "SetCurrentProgramScene",
        requestId: "trocarCena" + Date.now(),
        requestData: {
          sceneName: sceneName
        }
      }
    };

    obs.send(JSON.stringify(msg));
    console.log("ðŸŽ¬ Cena solicitada:", sceneName);
  }

  connectOBS(); // Conectar assim que o script carregar
